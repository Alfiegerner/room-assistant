(self.webpackChunkroom_assistant=self.webpackChunkroom_assistant||[]).push([[436],{4794:(n,e,s)=>{"use strict";s.r(e),s.d(e,{data:()=>a});const a={key:"v-6ac49b02",path:"/guide/quickstart-pi-zero-w.html",title:"Raspberry Pi Zero W",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"Requirements",slug:"requirements",children:[{level:3,title:"Hardware",slug:"hardware",children:[]},{level:3,title:"Software",slug:"software",children:[]}]},{level:2,title:"Installing Raspbian",slug:"installing-raspbian",children:[]},{level:2,title:"Installing room-assistant",slug:"installing-room-assistant",children:[]},{level:2,title:"Configuring room-assistant",slug:"configuring-room-assistant",children:[]},{level:2,title:"Making sure it always runs",slug:"making-sure-it-always-runs",children:[]}],filePathRelative:"guide/quickstart-pi-zero-w.md",git:{updatedTime:1624223567e3,contributors:[]}}},196:(n,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>en});var a=s(6252),t=s(9528);const l=(0,a.Wm)("h1",{id:"raspberry-pi-zero-w"},[(0,a.Wm)("a",{class:"header-anchor",href:"#raspberry-pi-zero-w"},"#"),(0,a.Uk)(" Raspberry Pi Zero W")],-1),i=(0,a.Wm)("p",null,"This page will guide you through setting up a Pi Zero W to run room-assistant.",-1),o=(0,a.Wm)("h2",{id:"requirements"},[(0,a.Wm)("a",{class:"header-anchor",href:"#requirements"},"#"),(0,a.Uk)(" Requirements")],-1),r=(0,a.Wm)("h3",{id:"hardware"},[(0,a.Wm)("a",{class:"header-anchor",href:"#hardware"},"#"),(0,a.Uk)(" Hardware")],-1),m=(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,"Raspberry Pi Zero W + Power Supply"),(0,a.Wm)("li",null,"Micro SD Card (ideally Application Class 1)"),(0,a.Wm)("li",null,"SD Card reader")],-1),u=(0,a.Wm)("h3",{id:"software"},[(0,a.Wm)("a",{class:"header-anchor",href:"#software"},"#"),(0,a.Uk)(" Software")],-1),c={href:"https://www.raspberrypi.org/software/",target:"_blank",rel:"noopener noreferrer"},p=(0,a.Uk)("Raspberry Pi Imager"),d=(0,a.Wm)("h2",{id:"installing-raspbian"},[(0,a.Wm)("a",{class:"header-anchor",href:"#installing-raspbian"},"#"),(0,a.Uk)(" Installing Raspbian")],-1),W=(0,a.Wm)("li",null,"Put your microSD card into your card reader.",-1),b=(0,a.Uk)("Open the "),h={href:"https://www.raspberrypi.org/software/",target:"_blank",rel:"noopener noreferrer"},k=(0,a.Uk)("Raspberry Pi Imager"),g=(0,a.Uk)(" and select the following options: "),f=(0,a.Wm)("ol",null,[(0,a.Wm)("li",null,"OS -> Raspberry Pi OS (other) -> Raspberry Pi OS (Lite)"),(0,a.Wm)("li",null,"SD Card -> the SD card you put into your card reader"),(0,a.Wm)("li",null,[(0,a.Uk)("Open the advanced options (Windows: "),(0,a.Wm)("em",null,"Ctrl + Shift + X"),(0,a.Uk)(", macOS: "),(0,a.Wm)("em",null,"Cmd + Shift + X"),(0,a.Uk)(") and enable SSH. Optionally, you can configure WiFi credentials, the hostname to be something recognizable like "),(0,a.Wm)("code",null,"bedroom"),(0,a.Uk)(' and more in this same menu. Hit "Save" on the bottom after you\'re done.')])],-1),y=(0,a.Wm)("li",null,"Write the image to the card from the main menu. Wait for it to be finished before removing the card from the reader.",-1),w=(0,a.Wm)("li",null,"Insert the SD card into your Raspberry Pi Zero W, then connect the power supply. Wait a minute for it to boot and connect to your network.",-1),U=(0,a.Uk)("Open a SSH shell to "),v=(0,a.Wm)("code",null,"<hostname>.local",-1),S=(0,a.Uk)(" (default: "),C=(0,a.Wm)("code",null,"raspberrypi.local",-1),P=(0,a.Uk)(") with the user "),R=(0,a.Wm)("code",null,"pi",-1),x=(0,a.Uk)(" and the password you configured (default: "),T=(0,a.Wm)("code",null,"raspberry",-1),I=(0,a.Uk)("). On Windows you can use "),O={href:"https://www.putty.org",target:"_blank",rel:"noopener noreferrer"},_=(0,a.Uk)("Putty"),H=(0,a.Uk)(", with Linux and macOS you can just open the terminal and e.g. type "),q=(0,a.Wm)("code",null,"ssh pi@raspberrypi.local",-1),A=(0,a.Uk)(". If the hostname is not found, use the IP of the Pi instead - it can be found in your router administration panel."),D=(0,a.Wm)("h2",{id:"installing-room-assistant"},[(0,a.Wm)("a",{class:"header-anchor",href:"#installing-room-assistant"},"#"),(0,a.Uk)(" Installing room-assistant")],-1),Z=(0,a.Wm)("ol",null,[(0,a.Wm)("li",null,[(0,a.Wm)("p",null,"Now we install NodeJS by running"),(0,a.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a.Wm)("pre",{class:"language-bash"},[(0,a.Wm)("code",null,[(0,a.Wm)("span",{class:"token function"},"wget"),(0,a.Uk)(" -O - https://gist.githubusercontent.com/mKeRix/88b7b81e9bca044f74de1dc51696efb2/raw/799a20bca44cc61d8f8ae93878f2f28af8365a69/getNodeLTS.sh "),(0,a.Wm)("span",{class:"token operator"},"|"),(0,a.Uk)(),(0,a.Wm)("span",{class:"token function"},"bash"),(0,a.Uk)("\n")])]),(0,a.Wm)("div",{class:"line-numbers"},[(0,a.Wm)("span",{class:"line-number"},"1"),(0,a.Wm)("br")])])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Uk)("To make the commands we install with npm available the $PATH environment variable needs to be extended as well. Edit the file "),(0,a.Wm)("code",null,"~/.profile"),(0,a.Uk)(" (e.g. with "),(0,a.Wm)("code",null,"nano ~/.profile"),(0,a.Uk)(") and add the "),(0,a.Wm)("code",null,'PATH="$PATH:/opt/nodejs/bin"'),(0,a.Uk)(" to the end of the file. Save, then run "),(0,a.Wm)("code",null,"source ~/.profile"),(0,a.Uk)(".")])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Uk)("We need to install some other dependencies as well, do so by running "),(0,a.Wm)("code",null,"sudo apt-get update && sudo apt-get install build-essential libavahi-compat-libdnssd-dev libsystemd-dev bluetooth libbluetooth-dev libudev-dev libcairo2-dev libpango1.0-dev libjpeg-dev libgif-dev librsvg2-dev"),(0,a.Uk)(".")])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Uk)("Now let's get install room-assistant! Run "),(0,a.Wm)("code",null,"sudo npm i --global --unsafe-perm room-assistant"),(0,a.Uk)(". You will see messages like the one shown below during the installation process. Don't worry about them - they're not errors!")]),(0,a.Wm)("p",null,[(0,a.Wm)("img",{src:t.Z,alt:"compilation messages"})])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Wm)("em",null,"Optional:"),(0,a.Uk)(" If you want to run Bluetooth related integrations, you should also grant some additional permissions by executing the commands below.")]),(0,a.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a.Wm)("pre",{class:"language-bash"},[(0,a.Wm)("code",null,[(0,a.Wm)("span",{class:"token function"},"sudo"),(0,a.Uk)(" setcap cap_net_raw+eip "),(0,a.Wm)("span",{class:"token variable"},[(0,a.Wm)("span",{class:"token variable"},"$("),(0,a.Wm)("span",{class:"token builtin class-name"},"eval"),(0,a.Uk)(" readlink -f `which node`"),(0,a.Wm)("span",{class:"token variable"},")")]),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token function"},"sudo"),(0,a.Uk)(" setcap cap_net_raw+eip "),(0,a.Wm)("span",{class:"token variable"},[(0,a.Wm)("span",{class:"token variable"},"$("),(0,a.Wm)("span",{class:"token builtin class-name"},"eval"),(0,a.Uk)(" readlink -f `which hcitool`"),(0,a.Wm)("span",{class:"token variable"},")")]),(0,a.Uk)("\n"),(0,a.Wm)("span",{class:"token function"},"sudo"),(0,a.Uk)(" setcap cap_net_admin+eip "),(0,a.Wm)("span",{class:"token variable"},[(0,a.Wm)("span",{class:"token variable"},"$("),(0,a.Wm)("span",{class:"token builtin class-name"},"eval"),(0,a.Uk)(" readlink -f `which hciconfig`"),(0,a.Wm)("span",{class:"token variable"},")")]),(0,a.Uk)("\n")])]),(0,a.Wm)("div",{class:"line-numbers"},[(0,a.Wm)("span",{class:"line-number"},"1"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"2"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"3"),(0,a.Wm)("br")])])])],-1),j=(0,a.Wm)("h2",{id:"configuring-room-assistant"},[(0,a.Wm)("a",{class:"header-anchor",href:"#configuring-room-assistant"},"#"),(0,a.Uk)(" Configuring room-assistant")],-1),z=(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Uk)("Create a config folder for room-assistant with "),(0,a.Wm)("code",null,"mkdir -p ~/room-assistant/config"),(0,a.Uk)(".")])],-1),L=(0,a.Uk)("Create a new config file with "),M=(0,a.Wm)("code",null,"nano ~/room-assistant/config/local.yml",-1),N=(0,a.Uk)(" and put your room-assistant configuration in it. The example below configures the "),$=(0,a.Uk)("Home Assistant Core"),B=(0,a.Uk)(" and "),E=(0,a.Uk)("Bluetooth Classic"),Y=(0,a.Uk)(" integrations. If you want to use something else check out the "),Q=(0,a.Wm)("a",{href:"/integrations"},"integrations",-1),X=(0,a.Uk)(" section."),F=(0,a.uE)('<div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">global</span><span class="token punctuation">:</span>\n  <span class="token key atrule">integrations</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> homeAssistant\n    <span class="token punctuation">-</span> bluetoothClassic\n<span class="token key atrule">homeAssistant</span><span class="token punctuation">:</span>\n  <span class="token key atrule">mqttUrl</span><span class="token punctuation">:</span> <span class="token string">&#39;mqtt://homeassistant.local:1883&#39;</span>\n  <span class="token key atrule">mqttOptions</span><span class="token punctuation">:</span>\n    <span class="token key atrule">username</span><span class="token punctuation">:</span> youruser\n    <span class="token key atrule">password</span><span class="token punctuation">:</span> yourpass\n<span class="token key atrule">bluetoothClassic</span><span class="token punctuation">:</span>\n  <span class="token key atrule">addresses</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> &lt;bluetooth<span class="token punctuation">-</span>mac<span class="token punctuation">-</span>of<span class="token punctuation">-</span>device<span class="token punctuation">-</span>to<span class="token punctuation">-</span>track<span class="token punctuation">&gt;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div>',1),G=(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Uk)("Go to your room-assistant directory by executing "),(0,a.Wm)("code",null,"cd ~/room-assistant"),(0,a.Uk)(".")])],-1),J=(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Uk)("Run room-assistant by executing "),(0,a.Wm)("code",null,"room-assistant"),(0,a.Uk)(". Watch the logs - are all integrations are loaded correctly and is the MQTT connection succesful? Then congratulations, you configured room-assistant correctly! 🎉 New entities should now be appearing under the MQTT integration in Home Assistant Core, which can be viewed in Settings > Integrations.")])],-1),K=(0,a.Wm)("div",{class:"custom-container tip"},[(0,a.Wm)("p",{class:"custom-container-title"},"TIP"),(0,a.Wm)("p",null,"When starting room-assistant you will see warnings about the Apple Bonjour compatibility layer of Avahi. These won't impact the functionality at all and can just be ignored.")],-1),V=(0,a.Wm)("h2",{id:"making-sure-it-always-runs"},[(0,a.Wm)("a",{class:"header-anchor",href:"#making-sure-it-always-runs"},"#"),(0,a.Uk)(" Making sure it always runs")],-1),nn=(0,a.Wm)("ol",null,[(0,a.Wm)("li",null,[(0,a.Wm)("p",null,"If room-assistant is still running from the previous step, stop it by hitting Ctrl + C on your keyboard.")]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Uk)("Create a file using "),(0,a.Wm)("code",null,"sudo nano /etc/systemd/system/room-assistant.service"),(0,a.Uk)(" with the following contents:")]),(0,a.Wm)("div",{class:"language-text ext-text line-numbers-mode"},[(0,a.Wm)("pre",{class:"language-text"},[(0,a.Wm)("code",null,"[Unit]\nDescription=room-assistant service\n\n[Service]\nType=notify\nExecStart=/opt/nodejs/bin/room-assistant\nWorkingDirectory=/home/pi/room-assistant\nTimeoutStartSec=120\nTimeoutStopSec=30\nRestart=always\nRestartSec=10\nWatchdogSec=60\nUser=pi\n\n[Install]\nWantedBy=multi-user.target\n")]),(0,a.Wm)("div",{class:"line-numbers"},[(0,a.Wm)("span",{class:"line-number"},"1"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"2"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"3"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"4"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"5"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"6"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"7"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"8"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"9"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"10"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"11"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"12"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"13"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"14"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"15"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"16"),(0,a.Wm)("br")])])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,"Enable and start your service by executing the commands below."),(0,a.Wm)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,a.Wm)("pre",{class:"language-bash"},[(0,a.Wm)("code",null,[(0,a.Wm)("span",{class:"token function"},"sudo"),(0,a.Uk)(" systemctl "),(0,a.Wm)("span",{class:"token builtin class-name"},"enable"),(0,a.Uk)(" room-assistant.service\n"),(0,a.Wm)("span",{class:"token function"},"sudo"),(0,a.Uk)(" systemctl start room-assistant.service\n")])]),(0,a.Wm)("div",{class:"line-numbers"},[(0,a.Wm)("span",{class:"line-number"},"1"),(0,a.Wm)("br"),(0,a.Wm)("span",{class:"line-number"},"2"),(0,a.Wm)("br")])])]),(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[(0,a.Uk)("Congratulations, you are done! 🎊 You may check the status of the service at any time with "),(0,a.Wm)("code",null,"sudo systemctl status room-assistant"),(0,a.Uk)(". room-assistant will now be started when the Pi Zero W boots.")])])],-1),en={render:function(n,e){const s=(0,a.up)("OutboundLink"),t=(0,a.up)("RouterLink");return(0,a.wg)(),(0,a.j4)(a.HY,null,[l,i,o,r,m,u,(0,a.Wm)("ul",null,[(0,a.Wm)("li",null,[(0,a.Wm)("a",c,[p,(0,a.Wm)(s)])])]),d,(0,a.Wm)("ol",null,[W,(0,a.Wm)("li",null,[b,(0,a.Wm)("a",h,[k,(0,a.Wm)(s)]),g,f]),y,w,(0,a.Wm)("li",null,[U,v,S,C,P,R,x,T,I,(0,a.Wm)("a",O,[_,(0,a.Wm)(s)]),H,q,A])]),D,Z,j,(0,a.Wm)("ol",null,[z,(0,a.Wm)("li",null,[(0,a.Wm)("p",null,[L,M,N,(0,a.Wm)(t,{to:"/integrations/home-assistant.html"},{default:(0,a.w5)((()=>[$])),_:1}),B,(0,a.Wm)(t,{to:"/integrations/bluetooth-classic.html"},{default:(0,a.w5)((()=>[E])),_:1}),Y,Q,X]),F]),G,J]),K,V,nn],64)}}},9528:(n,e,s)=>{"use strict";s.d(e,{Z:()=>a});const a=s.p+"assets/img/compilation-msgs.f118553e.png"}}]);